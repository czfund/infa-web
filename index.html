<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>INFA V3 - Official Presale</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.0/ethers.umd.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-950 text-white font-sans p-4">

    <div class="max-w-xl mx-auto bg-slate-900 border border-slate-800 p-8 rounded-3xl shadow-2xl mt-10">
        <h1 class="text-3xl font-black mb-2">INFA <span class="text-blue-500">V3</span></h1>
        <p class="text-xs text-slate-500 mb-8 font-mono">Contract: 0x46Af...14e8</p>

        <div class="grid grid-cols-2 gap-4 mb-8">
            <div class="bg-slate-950 p-4 rounded-xl border border-slate-800">
                <p class="text-[10px] text-slate-500 uppercase font-bold">Raised</p>
                <p id="raisedBNB" class="text-xl font-mono">0.00 BNB</p>
            </div>
            <div class="bg-slate-950 p-4 rounded-xl border border-slate-800">
                <p class="text-[10px] text-slate-500 uppercase font-bold">Hard Cap</p>
                <p id="hardCapBNB" class="text-xl font-mono">0.00 BNB</p>
            </div>
        </div>

        <div class="space-y-4">
            <input id="buyAmt" type="number" placeholder="Amount in BNB" class="w-full bg-slate-950 border border-slate-700 p-4 rounded-xl outline-none focus:border-blue-500 text-2xl font-bold">
            <button onclick="buyNow()" class="w-full bg-blue-600 hover:bg-blue-500 py-4 rounded-xl font-black text-lg transition shadow-lg shadow-blue-900/20">BUY TOKENS</button>
            <p id="minMsg" class="text-center text-[10px] text-slate-500 italic">Minimum: Fetching...</p>
        </div>
    </div>

    <script>
        const PRE_ADDR = "0x46AfBDE3967ec36D30bc3E27f804B820459714e8";
        // Exact names from your Solidity source code:
        const PRE_ABI = [
            "function raisedBNB() view returns (uint256)",
            "function hardCapBNB() view returns (uint256)",
            "function minBuyBNB() view returns (uint256)",
            "function buy(address affiliate) external payable"
        ];

        let provider, signer, contract;

        async function connect() {
            if (!window.ethereum) return alert("MetaMask needed");
            provider = new ethers.BrowserProvider(window.ethereum);
            signer = await provider.getSigner();
            contract = new ethers.Contract(PRE_ADDR, PRE_ABI, signer);
            sync();
        }

        async function sync() {
            // Using the exact variables from your .sol file
            const raised = await contract.raisedBNB();
            const cap = await contract.hardCapBNB();
            const min = await contract.minBuyBNB();

            document.getElementById('raisedBNB').innerText = ethers.formatEther(raised) + " BNB";
            document.getElementById('hardCapBNB').innerText = ethers.formatEther(cap) + " BNB";
            document.getElementById('minMsg').innerText = "Minimum: " + ethers.formatEther(min) + " BNB";
        }

        async function buyNow() {
            const amt = document.getElementById('buyAmt').value;
            if(!amt) return;
            try {
                // Your contract requires an affiliate address. 
                // We use the 'Zero Address' if no one referred them.
                const tx = await contract.buy("0x0000000000000000000000000000000000000000", {
                    value: ethers.parseEther(amt.toString())
                });
                await tx.wait();
                alert("Success!");
                sync();
            } catch (e) { alert("Error: Check your balance or min buy"); }
        }

        window.onload = connect; // Auto-connect attempt
    </script>
</body>
</html>
